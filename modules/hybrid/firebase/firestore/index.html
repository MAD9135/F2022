<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Firebase Firestore | MAD9135</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="JavaScript App Development">
    
    <link rel="preload" href="/F2022/assets/css/0.styles.69eb72d8.css" as="style"><link rel="preload" href="/F2022/assets/js/app.e8c285b9.js" as="script"><link rel="preload" href="/F2022/assets/js/2.9a13455f.js" as="script"><link rel="preload" href="/F2022/assets/js/11.9c100ec9.js" as="script"><link rel="preload" href="/F2022/assets/js/6.351fee7d.js" as="script"><link rel="prefetch" href="/F2022/assets/js/10.19db6b1e.js"><link rel="prefetch" href="/F2022/assets/js/12.66792850.js"><link rel="prefetch" href="/F2022/assets/js/13.570695c0.js"><link rel="prefetch" href="/F2022/assets/js/14.6f8baaa9.js"><link rel="prefetch" href="/F2022/assets/js/15.9fe338ad.js"><link rel="prefetch" href="/F2022/assets/js/16.14a225ab.js"><link rel="prefetch" href="/F2022/assets/js/17.9889dd9b.js"><link rel="prefetch" href="/F2022/assets/js/18.b9f44afa.js"><link rel="prefetch" href="/F2022/assets/js/19.1a5d1eb8.js"><link rel="prefetch" href="/F2022/assets/js/20.bfc9c373.js"><link rel="prefetch" href="/F2022/assets/js/21.b0d5e3b9.js"><link rel="prefetch" href="/F2022/assets/js/22.71501c8b.js"><link rel="prefetch" href="/F2022/assets/js/23.c7ffdeef.js"><link rel="prefetch" href="/F2022/assets/js/24.2d7e7868.js"><link rel="prefetch" href="/F2022/assets/js/25.6973b344.js"><link rel="prefetch" href="/F2022/assets/js/26.5381df9b.js"><link rel="prefetch" href="/F2022/assets/js/27.94beb76f.js"><link rel="prefetch" href="/F2022/assets/js/28.35bb8e11.js"><link rel="prefetch" href="/F2022/assets/js/29.44383e10.js"><link rel="prefetch" href="/F2022/assets/js/3.4ca6bd9c.js"><link rel="prefetch" href="/F2022/assets/js/30.5979e619.js"><link rel="prefetch" href="/F2022/assets/js/31.fe59b532.js"><link rel="prefetch" href="/F2022/assets/js/32.439d6653.js"><link rel="prefetch" href="/F2022/assets/js/33.f324c148.js"><link rel="prefetch" href="/F2022/assets/js/34.3e1bc0a2.js"><link rel="prefetch" href="/F2022/assets/js/35.db6b2965.js"><link rel="prefetch" href="/F2022/assets/js/36.ab816086.js"><link rel="prefetch" href="/F2022/assets/js/37.07e54435.js"><link rel="prefetch" href="/F2022/assets/js/38.deea1f87.js"><link rel="prefetch" href="/F2022/assets/js/39.72fff846.js"><link rel="prefetch" href="/F2022/assets/js/4.b42af5b4.js"><link rel="prefetch" href="/F2022/assets/js/40.f25af6c1.js"><link rel="prefetch" href="/F2022/assets/js/41.b75d764d.js"><link rel="prefetch" href="/F2022/assets/js/42.e7b3e635.js"><link rel="prefetch" href="/F2022/assets/js/43.ef823a68.js"><link rel="prefetch" href="/F2022/assets/js/44.e65ceadf.js"><link rel="prefetch" href="/F2022/assets/js/45.2653971e.js"><link rel="prefetch" href="/F2022/assets/js/46.2e7a0afa.js"><link rel="prefetch" href="/F2022/assets/js/47.c93b6eb6.js"><link rel="prefetch" href="/F2022/assets/js/48.22a6269b.js"><link rel="prefetch" href="/F2022/assets/js/49.cdbc262a.js"><link rel="prefetch" href="/F2022/assets/js/5.aef0857f.js"><link rel="prefetch" href="/F2022/assets/js/50.411c7402.js"><link rel="prefetch" href="/F2022/assets/js/51.5a18911f.js"><link rel="prefetch" href="/F2022/assets/js/52.ce0eea3f.js"><link rel="prefetch" href="/F2022/assets/js/53.d55f9ed3.js"><link rel="prefetch" href="/F2022/assets/js/54.6a7af4f1.js"><link rel="prefetch" href="/F2022/assets/js/55.8779cc6a.js"><link rel="prefetch" href="/F2022/assets/js/56.281c9c8b.js"><link rel="prefetch" href="/F2022/assets/js/57.e36954dd.js"><link rel="prefetch" href="/F2022/assets/js/58.5c8be1f9.js"><link rel="prefetch" href="/F2022/assets/js/7.0bb8b12a.js"><link rel="prefetch" href="/F2022/assets/js/8.a2a70e3a.js"><link rel="prefetch" href="/F2022/assets/js/9.5279d356.js">
    <link rel="stylesheet" href="/F2022/assets/css/0.styles.69eb72d8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/F2022/" class="home-link router-link-active"><img src="/F2022/mad-d-logo-sm.png" alt="MAD9135" class="logo"> <span class="site-name can-hide">MAD9135</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/F2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/F2022/deliverables/" class="nav-link">
  Assignments
</a></div><div class="nav-item"><a href="/F2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/F2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/F2022/deliverables/" class="nav-link">
  Assignments
</a></div><div class="nav-item"><a href="/F2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Firebase Hybrid Content</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/F2022/modules/hybrid/firebase/" aria-current="page" class="sidebar-link">Firebase Introduction</a></li><li><a href="/F2022/modules/hybrid/firebase/firestore/" aria-current="page" class="active sidebar-link">Firebase Firestore</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#firestore" class="sidebar-link">Firestore</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#adding-firebase-to-the-webpack-project" class="sidebar-link">Adding Firebase to the Webpack Project</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#creating-the-firestore-database" class="sidebar-link">Creating the FireStore Database</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#talking-to-firestore-from-webpages" class="sidebar-link">Talking to Firestore from Webpages</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#reading-existing-documents" class="sidebar-link">Reading existing documents</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#adding-new-documents" class="sidebar-link">Adding new documents</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#editing-documents" class="sidebar-link">Editing documents</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#deleting-documents" class="sidebar-link">Deleting documents</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#listening-for-changes-in-the-database" class="sidebar-link">Listening for Changes in the Database</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#filtering-and-ordering-the-data" class="sidebar-link">Filtering and Ordering the Data</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#limiting-the-number-of-documents" class="sidebar-link">Limiting the Number of Documents</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#starter-project" class="sidebar-link">Starter Project</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/#firebase-quotas" class="sidebar-link">Firebase Quotas</a></li></ul></li><li><a href="/F2022/modules/hybrid/firebase/firestore/sample.html" class="sidebar-link">Firestore Starter Project</a></li><li><a href="/F2022/modules/hybrid/firebase/authentication/" class="sidebar-link">Firebase Authentication</a></li><li><a href="/F2022/modules/hybrid/firebase/permissions/" class="sidebar-link">Firebase Permissions</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Next JS &amp; React Native</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title gold">
    Firebase
  </div> <h1>Firebase Firestore</h1></header> <h2 id="firestore"><a href="#firestore" class="header-anchor">#</a> Firestore</h2> <p>Firestore is the database portion of the Firebase service collection. It is a document database like <code>MongoDB</code>, not a relational database like <code>MySQL</code>.</p> <p>To start using Firestore, we need to go to our <a href="https://console.firebase.google.com/" target="_blank" rel="noopener noreferrer">Firebase console<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Log in if you are not already logged in. You should see a screen that is similar to this:</p> <p><img src="/F2022/assets/img/fb-console.19ac518e.png" alt="Console homepage"></p> <p>You will want to click on the button to <code>Add Project</code>.</p> <p>Google will want to know what you are calling your project. This is a name just for your own reference. Eventually you will have many projects and will want to remember what each one is. For this first one try <code>stupid-first-project</code>.</p> <p>Then be sure to check the checkbox confirming that you <code>will use Firebase exclusively for purposes relating to my trade, business, craft or profession.</code></p> <p>On step 2, disable Google Analytics so you don't end up getting reminder emails and/or unexpected charges for use of Analytics. We will not need them. Then click on the button to create your project. This takes less than a minute typically.</p> <p>When complete, you will see a success message and a button to <code>continue</code>. Click the <code>continue</code> button to be taken to the console home page for your project.</p> <p>Within your Project you can add an App and start connecting the various Firebase Services. Click on the <code>Build</code> button in the left-hand menu to see the list of services that you can add to your project. A Project can contain multiple apps and multiple services. HOWEVER, the free version only let's you have one app per project.</p> <p>We want to use <code>Firestore</code> and we are going to use it within a Web App. So, click on the Web App icon that looks like - <code>&lt;/&gt;</code>.</p> <p>You will be prompted again for a name. This one is for the app. This is just a label for you. It can be the same as the project name or something different. Try <code>stupid-first-app</code>.</p> <p>Skip the option to add <code>Hosting</code>.</p> <p>You will be given a bunch of code that you can copy but do not worry. This code will be available again for you to copy.</p> <p>When you get back to your console, you will see a card with your <code>stupid-first-app</code>. Click on the COG icon and scroll down the page to see that code sample.</p> <h2 id="adding-firebase-to-the-webpack-project"><a href="#adding-firebase-to-the-webpack-project" class="header-anchor">#</a> Adding Firebase to the Webpack Project</h2> <p>Back in VSCode, we want to add support for our Firebase project and app. In the Terminal we will use <code>npm</code> to add Firebase support.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> firebase
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Next, we open the <code>/src/index.js</code> file and paste in the code that starts with:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Import the functions you need from the SDKs you need</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> initializeApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/app'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>and ends with:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Initialize Firebase</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">initializeApp</span><span class="token punctuation">(</span>firebaseConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>All the stuff in the middle are the keys and ids that your app will need to communicate with Firebase and Firestore. These keys WILL be visible in your client-side JavaScript. However, there are server-side protections as well. Do not worry about them being visible. It is only as dangerous as people on YouTube knowing that my username is <code>Prof3ssorSt3v3</code>.</p> <h2 id="creating-the-firestore-database"><a href="#creating-the-firestore-database" class="header-anchor">#</a> Creating the FireStore Database</h2> <p>Back in the Firebase Console, click on the <code>Firestore Database</code> link in the left-hand menu, inside of the <code>Build</code> section.</p> <p>Next click on the <code>Create</code> button to create a new empty Firestore database.</p> <p>Be sure to <code>Start in Test Mode</code>. We will come back and talk more about permissions later on.</p> <p>In the textarea to the right of the <code>Start in Test Mode</code> radio button, will have a date that is 30 days after the current date. <strong>Later</strong> we will edit this value to be <code>timestamp.date(2022, 12, 25)</code>. This will prevent your app from becoming unavailable accidentally before the end of the semester.</p> <p>The second step is to choose a location to host the database. The default <code>nam5 (us-central)</code> is the best option for us. This value cannot be changed after it is selected.</p> <h3 id="creating-collections-and-records"><a href="#creating-collections-and-records" class="header-anchor">#</a> Creating Collections and Records.</h3> <p>Once the database has been created, then you will have an empty database. It will look something like the image below.</p> <p><img src="/F2022/assets/img/empty-db.f9af516d.png" alt="Empty DB and Collection"></p> <p>Click on the <code>+Start Collection</code> button to create a container for your first group of documents.</p> <div class="custom-block tip"><p class="custom-block-title">Remember</p> <p>A Collection is a group of one or more documents.</p> <p>A document is a JSON-style object.</p></div> <p>In Firestore, every document that you create needs to have a property called <code>_id</code>. If you do not add one, then one will automatically be created for you. The automatic creation of the id is the easiest and the recommended approach. If you have other &quot;id&quot; like properties you can also add those to the document, but the <code>_id</code> one will be used by Firestore to identify each document.</p> <p>If you want, you can manually create as many collections and records as you want. If you have a bunch of starter data, feel free to add this through the Firebase Firestore console.</p> <div class="custom-block tip"><p class="custom-block-title">Try This Now</p> <p>Go ahead and manually create a collection to get used to the interface.</p> <p>Create a collection called <code>people</code>.</p> <p>Create a sample document inside <code>people</code> with three properties, a string property called <code>name</code>, a numeric property called <code>birth-month</code> and a numeric property called <code>birth-day</code>.</p></div> <p>Soon, we will be managing all of our collections and documents through JavaScript.</p> <h2 id="talking-to-firestore-from-webpages"><a href="#talking-to-firestore-from-webpages" class="header-anchor">#</a> Talking to Firestore from Webpages</h2> <p>Once you have the <code>initializeApp</code> method imported from <code>firebase/app</code> and called, then we can start importing other functions from <code>firebase/firestore</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> initializeApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/app'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getFirestore<span class="token punctuation">,</span> collection<span class="token punctuation">,</span> doc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>
<span class="token comment">//to access Firestore to connect to the database</span>
<span class="token comment">// to access a collection</span>
<span class="token comment">// to access a document from a collection</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">initializeApp</span><span class="token punctuation">(</span>firebaseConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">getFirestore</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myDocumentRef <span class="token operator">=</span> <span class="token function">doc</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">,</span> <span class="token string">'document-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myCollectionRef <span class="token operator">=</span> <span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="reading-existing-documents"><a href="#reading-existing-documents" class="header-anchor">#</a> Reading existing documents</h2> <p>To read information from a collection, we can use the <code>getDocs</code> method. This returns a <code>querysnapshot</code> object, similar to an array, that is filled with all the documents from the collection.</p> <p>This first example is to get ALL of the documents from a collection.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> collection<span class="token punctuation">,</span> getDocs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> querySnapshot <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDocs</span><span class="token punctuation">(</span><span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
querySnapshot<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>doc<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> =&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>If you want to retrieve a SINGLE document from a collection, then we use the <code>getDoc</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> collection<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> getDoc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> collectionRef <span class="token operator">=</span> <span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//get a reference to the collection</span>
<span class="token keyword">const</span> docRef <span class="token operator">=</span> <span class="token function">doc</span><span class="token punctuation">(</span>collectionRef<span class="token punctuation">,</span> <span class="token string">'document-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//use the collection reference to get a reference to a specific document.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>If you want to retrieve a range of values from a collection, we can use the <code>query</code> and <code>where</code> methods.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> collection<span class="token punctuation">,</span> query<span class="token punctuation">,</span> where<span class="token punctuation">,</span> getDocs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> docs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>
  <span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'isActive'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> querySnapshot <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDocs</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>

querySnapshot<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// doc.data() is never undefined for query doc snapshots</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">' =&gt; '</span><span class="token punctuation">,</span> doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Once you have the reference to a document object, we will then use the <code>getDoc</code> method to extract a snapshot of the data in that document.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> docSnap <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDoc</span><span class="token punctuation">(</span>docRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>docSnap<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//check if the document existed... if data() would return anything</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Document data:'</span><span class="token punctuation">,</span> docSnap<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//get the data from the snapshot</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// doc.data() will be undefined in this case</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'No such document!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>If your app is an offline first PWA, then Firestore actually has the ability to cache the results and you can retrieve the most recent values from a local cached version of the collection or document.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Get a document, forcing the SDK to fetch from the offline cache.</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cacheDoc <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDocFromCache</span><span class="token punctuation">(</span>docRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Document was found in the cache.</span>
  <span class="token comment">// If no cached document exists, an error will be returned to the 'catch' block below.</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Cached document data:'</span><span class="token punctuation">,</span> doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error getting cached document:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>If a document that we have stored in a document reference contains sub-collections then you can also call <code>listCollections()</code> on the <code>docRef</code> object. However, this is NOT available in the web version of the library, only the mobile versions.</p> <h2 id="adding-new-documents"><a href="#adding-new-documents" class="header-anchor">#</a> Adding new documents</h2> <p>Cloud Firestore supports a variety of data types for values: boolean, number, string, geo point, binary blob, and timestamp. You can also use arrays or nested objects, called maps, to structure data within a document.</p> <p>To insert new documents into a collection you will need to import the <code>collection</code> and <code>addDoc</code> methods from <code>firebase/firestore</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> collection<span class="token punctuation">,</span> addDoc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> docRef <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">addDoc</span><span class="token punctuation">(</span><span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Dean Winchester'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'dean@singersalvage.com'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">salary</span><span class="token operator">:</span> <span class="token number">75000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isActive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Document written with ID: '</span><span class="token punctuation">,</span> docRef<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error adding document: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="editing-documents"><a href="#editing-documents" class="header-anchor">#</a> Editing documents</h2> <p>To update a document, we need to get a <code>collection</code> reference, and then get a <code>doc</code> reference before we can use <code>setDoc</code> to do the update.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> collection<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> setDoc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> collectionRef <span class="token operator">=</span> <span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> docRef <span class="token operator">=</span> <span class="token function">doc</span><span class="token punctuation">(</span>collectionRef<span class="token punctuation">,</span> <span class="token string">'document-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> <span class="token function">setDoc</span><span class="token punctuation">(</span>docRef<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Dean Winchester'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'dean@algonquincollege.com'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">salary</span><span class="token operator">:</span> <span class="token number">55000</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isActive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="deleting-documents"><a href="#deleting-documents" class="header-anchor">#</a> Deleting documents</h2> <p>Deleting is simple. It uses the <code>deleteDoc</code> method and requires a document reference.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> doc<span class="token punctuation">,</span> deleteDoc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> <span class="token function">deleteDoc</span><span class="token punctuation">(</span><span class="token function">doc</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">,</span> <span class="token string">'document-id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="listening-for-changes-in-the-database"><a href="#listening-for-changes-in-the-database" class="header-anchor">#</a> Listening for Changes in the Database</h2> <p>One of the really powerful features of Firestore is that you can actually listen for changes that happen to the data. We do this through the <code>onSnapshot()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> doc<span class="token punctuation">,</span> onSnapshot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> <span class="token function">onSnapshot</span><span class="token punctuation">(</span>
  <span class="token function">doc</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">,</span> <span class="token string">'document-id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Current NEW data: '</span><span class="token punctuation">,</span> doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//error happened with an update</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//unsubscribe is a reference that you can use to stop listening for the snapshot events.</span>
<span class="token comment">// Stop listening to changes</span>
<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>You can also use <code>onSnapshot</code> to access the results of a <code>query()</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> collection<span class="token punctuation">,</span> query<span class="token punctuation">,</span> where<span class="token punctuation">,</span> onSnapshot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> q <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>
  <span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'prop'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> <span class="token function">onSnapshot</span><span class="token punctuation">(</span>
  q<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">snapshot</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> listOfNames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    snapshot<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      listOfNames<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Current names in collection: '</span><span class="token punctuation">,</span> listOfNames<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//error handler</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>When the <code>onSnapshot()</code> method is triggered, we can determine what kind of change happened. The possible types are <code>added</code>, <code>modified</code>, or <code>removed</code>. The <code>docChanges()</code> method gets called on the <code>snapshot</code> object</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> collection<span class="token punctuation">,</span> query<span class="token punctuation">,</span> where<span class="token punctuation">,</span> onSnapshot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> q <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>
  <span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'collection-name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'prop'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> <span class="token function">onSnapshot</span><span class="token punctuation">(</span>
  q<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">snapshot</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    snapshot<span class="token punctuation">.</span><span class="token function">docChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">change</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>change<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'added'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'New data: '</span><span class="token punctuation">,</span> change<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>change<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'modified'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Modified data: '</span><span class="token punctuation">,</span> change<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>change<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'removed'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Removed data: '</span><span class="token punctuation">,</span> change<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//error handler</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>You can learn <a href="https://firebase.google.com/docs/firestore/query-data/queries" target="_blank" rel="noopener noreferrer">more about query()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and how you can filter collection results.</p> <p><a href="https://firebase.google.com/docs/firestore/query-data/order-limit-data" target="_blank" rel="noopener noreferrer">This page explains about ordering and limiting<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for sorting and limiting the number of results that are returned.</p> <p>If you are making the changes to the data in your own local browser, the snapshot event will be triggered BEFORE the changes are made on the server. Learn more about <a href="https://firebase.google.com/docs/firestore/query-data/listen" target="_blank" rel="noopener noreferrer">onSnapshot here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="filtering-and-ordering-the-data"><a href="#filtering-and-ordering-the-data" class="header-anchor">#</a> Filtering and Ordering the Data</h2> <p>If you want to sort the data as it is returned from the database. You can import and use the <code>orderBy</code> method and use it inside the <code>query</code> method.</p> <p>If you want to filter the documents before they are returned from the database then you can use the <code>where</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>collection<span class="token punctuation">,</span> db<span class="token punctuation">,</span> query<span class="token punctuation">,</span> where<span class="token punctuation">,</span> orderBy<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> peopleCollectionRef <span class="token operator">=</span> <span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;people&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//collection we want to query</span>
  <span class="token keyword">const</span> docs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>
    peopleCollectionRef<span class="token punctuation">,</span>
    <span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'birth-month'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">'birth-day'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> querySnapshot <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDocs</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  querySnapshot<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//handle each of the documents from the people collection</span>
    <span class="token comment">//where the month is 12 </span>
    <span class="token comment">//all the documents will be sorted by birth-day </span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>You can add as many calls to <code>where</code> and as many calls to <code>orderBy</code> as you need inside the <code>query</code> method.</p> <div class="custom-block tip"><p class="custom-block-title">Indexes</p> <p>When you add an <code>orderBy</code> call to your query, then the database will need to create an index for each one. If you look in the console, you will see an error about the missing index with a link that you can click to create the index. It will take you to the firebase console and ask for confirmation before creating the index.</p></div> <h2 id="limiting-the-number-of-documents"><a href="#limiting-the-number-of-documents" class="header-anchor">#</a> Limiting the Number of Documents</h2> <p>If you want to limit the number of documents returned by your query, then you can import and use the <code>limit</code> method as the final parameter passed in to your <code>query()</code> method.</p> <h2 id="starter-project"><a href="#starter-project" class="header-anchor">#</a> Starter Project</h2> <p>Follow <a href="/F2022/modules/hybrid/firebase/firestore/sample.html">this link to the firestore starter project page</a>.</p> <p>Hint: building the starter project will get you 80% finished the first Hybrid Assignment.</p> <h2 id="firebase-quotas"><a href="#firebase-quotas" class="header-anchor">#</a> Firebase Quotas</h2> <p>The Free tier of Firebase has <a href="https://firebase.google.com/docs/firestore/quotas" target="_blank" rel="noopener noreferrer">usage quotas<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>A few of the quotas highlights:</p> <ul><li>1GB data storage.</li> <li>50K reads and 20K writes per day.</li> <li>10Gb network traffic per month.</li> <li>Each <code>document</code> is limited to 1MB.</li></ul> <p>Follow the link above to see the other restrictions on data and operations.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/6/2022, 8:15:04 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/F2022/modules/hybrid/firebase/" class="prev router-link-active">
        Firebase Introduction
      </a></span> <span class="next"><a href="/F2022/modules/hybrid/firebase/firestore/sample.html">
        Firestore Starter Project
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/F2022/assets/js/app.e8c285b9.js" defer></script><script src="/F2022/assets/js/2.9a13455f.js" defer></script><script src="/F2022/assets/js/11.9c100ec9.js" defer></script><script src="/F2022/assets/js/6.351fee7d.js" defer></script>
  </body>
</html>
