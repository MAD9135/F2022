<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Firestore Starter Project | MAD9135</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="JavaScript App Development">
    
    <link rel="preload" href="/F2022/assets/css/0.styles.69eb72d8.css" as="style"><link rel="preload" href="/F2022/assets/js/app.e8c285b9.js" as="script"><link rel="preload" href="/F2022/assets/js/2.9a13455f.js" as="script"><link rel="preload" href="/F2022/assets/js/23.c7ffdeef.js" as="script"><link rel="preload" href="/F2022/assets/js/6.351fee7d.js" as="script"><link rel="prefetch" href="/F2022/assets/js/10.19db6b1e.js"><link rel="prefetch" href="/F2022/assets/js/11.9c100ec9.js"><link rel="prefetch" href="/F2022/assets/js/12.66792850.js"><link rel="prefetch" href="/F2022/assets/js/13.570695c0.js"><link rel="prefetch" href="/F2022/assets/js/14.6f8baaa9.js"><link rel="prefetch" href="/F2022/assets/js/15.9fe338ad.js"><link rel="prefetch" href="/F2022/assets/js/16.14a225ab.js"><link rel="prefetch" href="/F2022/assets/js/17.9889dd9b.js"><link rel="prefetch" href="/F2022/assets/js/18.b9f44afa.js"><link rel="prefetch" href="/F2022/assets/js/19.1a5d1eb8.js"><link rel="prefetch" href="/F2022/assets/js/20.bfc9c373.js"><link rel="prefetch" href="/F2022/assets/js/21.b0d5e3b9.js"><link rel="prefetch" href="/F2022/assets/js/22.71501c8b.js"><link rel="prefetch" href="/F2022/assets/js/24.2d7e7868.js"><link rel="prefetch" href="/F2022/assets/js/25.6973b344.js"><link rel="prefetch" href="/F2022/assets/js/26.5381df9b.js"><link rel="prefetch" href="/F2022/assets/js/27.94beb76f.js"><link rel="prefetch" href="/F2022/assets/js/28.35bb8e11.js"><link rel="prefetch" href="/F2022/assets/js/29.44383e10.js"><link rel="prefetch" href="/F2022/assets/js/3.4ca6bd9c.js"><link rel="prefetch" href="/F2022/assets/js/30.5979e619.js"><link rel="prefetch" href="/F2022/assets/js/31.fe59b532.js"><link rel="prefetch" href="/F2022/assets/js/32.439d6653.js"><link rel="prefetch" href="/F2022/assets/js/33.f324c148.js"><link rel="prefetch" href="/F2022/assets/js/34.3e1bc0a2.js"><link rel="prefetch" href="/F2022/assets/js/35.db6b2965.js"><link rel="prefetch" href="/F2022/assets/js/36.ab816086.js"><link rel="prefetch" href="/F2022/assets/js/37.07e54435.js"><link rel="prefetch" href="/F2022/assets/js/38.deea1f87.js"><link rel="prefetch" href="/F2022/assets/js/39.72fff846.js"><link rel="prefetch" href="/F2022/assets/js/4.b42af5b4.js"><link rel="prefetch" href="/F2022/assets/js/40.f25af6c1.js"><link rel="prefetch" href="/F2022/assets/js/41.b75d764d.js"><link rel="prefetch" href="/F2022/assets/js/42.e7b3e635.js"><link rel="prefetch" href="/F2022/assets/js/43.ef823a68.js"><link rel="prefetch" href="/F2022/assets/js/44.e65ceadf.js"><link rel="prefetch" href="/F2022/assets/js/45.2653971e.js"><link rel="prefetch" href="/F2022/assets/js/46.2e7a0afa.js"><link rel="prefetch" href="/F2022/assets/js/47.c93b6eb6.js"><link rel="prefetch" href="/F2022/assets/js/48.22a6269b.js"><link rel="prefetch" href="/F2022/assets/js/49.cdbc262a.js"><link rel="prefetch" href="/F2022/assets/js/5.aef0857f.js"><link rel="prefetch" href="/F2022/assets/js/50.411c7402.js"><link rel="prefetch" href="/F2022/assets/js/51.5a18911f.js"><link rel="prefetch" href="/F2022/assets/js/52.ce0eea3f.js"><link rel="prefetch" href="/F2022/assets/js/53.d55f9ed3.js"><link rel="prefetch" href="/F2022/assets/js/54.6a7af4f1.js"><link rel="prefetch" href="/F2022/assets/js/55.8779cc6a.js"><link rel="prefetch" href="/F2022/assets/js/56.281c9c8b.js"><link rel="prefetch" href="/F2022/assets/js/57.e36954dd.js"><link rel="prefetch" href="/F2022/assets/js/58.5c8be1f9.js"><link rel="prefetch" href="/F2022/assets/js/7.0bb8b12a.js"><link rel="prefetch" href="/F2022/assets/js/8.a2a70e3a.js"><link rel="prefetch" href="/F2022/assets/js/9.5279d356.js">
    <link rel="stylesheet" href="/F2022/assets/css/0.styles.69eb72d8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/F2022/" class="home-link router-link-active"><img src="/F2022/mad-d-logo-sm.png" alt="MAD9135" class="logo"> <span class="site-name can-hide">MAD9135</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/F2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/F2022/deliverables/" class="nav-link">
  Assignments
</a></div><div class="nav-item"><a href="/F2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/F2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/F2022/deliverables/" class="nav-link">
  Assignments
</a></div><div class="nav-item"><a href="/F2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Firebase Hybrid Content</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/F2022/modules/hybrid/firebase/" aria-current="page" class="sidebar-link">Firebase Introduction</a></li><li><a href="/F2022/modules/hybrid/firebase/firestore/" aria-current="page" class="sidebar-link">Firebase Firestore</a></li><li><a href="/F2022/modules/hybrid/firebase/firestore/sample.html" aria-current="page" class="active sidebar-link">Firestore Starter Project</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/sample.html#description" class="sidebar-link">Description</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/sample.html#setup" class="sidebar-link">Setup</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/sample.html#github-repo-starter-code-for-hybrid-assignment" class="sidebar-link">Github Repo starter code for Hybrid Assignment</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/sample.html#development-steps-for-sample-project" class="sidebar-link">Development Steps for Sample Project</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/hybrid/firebase/firestore/sample.html#requirements-for-assignment" class="sidebar-link">Requirements for Assignment</a></li></ul></li><li><a href="/F2022/modules/hybrid/firebase/authentication/" class="sidebar-link">Firebase Authentication</a></li><li><a href="/F2022/modules/hybrid/firebase/permissions/" class="sidebar-link">Firebase Permissions</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Next JS &amp; React Native</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title gold">
    Firebase
  </div> <h1>Firestore Starter Project</h1></header> <h2 id="description"><a href="#description" class="header-anchor">#</a> Description</h2> <p>In this starter project we are going to build a simple Gift Idea web app that uses Firebase to store the list of people and the list of gift ideas for each person in the people collection.</p> <p>The app interface will be a single webpage with two columns. One column shows the list of people. The second column shows the list of gift ideas for the selected person, if one is selected.</p> <p>There will be a button to add a person which opens a dialog with a form.</p> <p>There will be a button to add a gift idea which opens a dialog with a form.</p> <div class="custom-block danger"><p class="custom-block-title">Missing Features</p> <p>This sample app has no ability to delete a person or gift idea.</p> <p>This sample app has no ability to edit people or gift ideas.</p> <p>This sample app only works for a single user. All the people and gift ideas are shared with anyone who access the web page.</p></div> <h2 id="setup"><a href="#setup" class="header-anchor">#</a> Setup</h2> <p><a href="https://github.com/prof3ssorSt3v3/firestore-giftr-starter" target="_blank" rel="noopener noreferrer">Repo with Starter Code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>We are assuming that this app will only be used by a single user. No permissions required at this stage. We will start with the project set up that was described back on the <a href="/F2022/modules/hybrid/firebase/" class="router-link-active">Firebase Hybrid main page</a>. Follow the instructions on that page for the basic npm and webpack set up.</p> <p>Then create, a single Firebase <strong>project</strong> called <code>Fire-Giftr</code>, with a single <strong>app</strong>. Add an empty database to your <strong>app</strong>.</p> <p>There will be a collection called <code>people</code> and a second collection called <code>gift-ideas</code>. Add these two collections via the Firebase Firestore console.</p> <p>In the <code>people</code> collection add two documents with the property names and types:</p> <ul><li><code>_id</code> [auto generated id with the Auto ID button]</li> <li><code>name</code> [string]</li> <li><code>birth-month</code> [numeric]</li> <li><code>birth-day</code> [numeric]</li></ul> <p>Put whatever values you want (matching the property types) into the properties for your two people.</p> <p>In the <code>gift-ideas</code> collection we will need</p> <ul><li><code>_id</code> [auto generated id]</li> <li><code>idea</code> [string]</li> <li><code>location</code> [string]</li> <li><code>person-id</code> [reference]</li></ul> <p>The <code>reference</code> data type means a path to a document somewhere in your database. An example value would look like <code>/people/GkeL9ij7HpVVXYeM0ZGg</code>. Assuming that <code>GkeL9ij7HpVVXYeM0ZGg</code> is the <code>_id</code> value of one of the two people you created. This is how we connect documents in different collections - by adding a property with the <code>reference</code> data type and giving it the value of a valid path. If you enter an invalid path, you will NOT get an error, it will just be wrong.</p> <h2 id="github-repo-starter-code-for-hybrid-assignment"><a href="#github-repo-starter-code-for-hybrid-assignment" class="header-anchor">#</a> Github Repo starter code for Hybrid Assignment</h2> <p>Your first Hybrid assignment is to take <strong>this sample project</strong> that we are building and add a few features.</p> <p><a href="https://github.com/prof3ssorSt3v3/firestore-giftr-starter" target="_blank" rel="noopener noreferrer">This repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> holds the starter code in its <code>main</code> branch. Start by <strong>forking</strong> this repo OR cloning it and replacing all the git info with your own.</p> <p>After you have a copy of your own forked or cloned version, add a new branch called <code>editdelete</code>. This new branch will be a copy of the <code>main</code> branch.</p> <p>Once you are working on the new <code>editdelete</code> feature branch you can start replacing the firebase connection settings with the ones for your own Firebase project.</p> <p>After the firebase connection settings are updated and you have created the <code>people</code> and <code>gift-ideas</code> collections, as described above, then your app should be able to run over your own localhost.</p> <h2 id="development-steps-for-sample-project"><a href="#development-steps-for-sample-project" class="header-anchor">#</a> Development Steps for Sample Project</h2> <p>The <code>main</code> branch of the starter code repo has all the HTML and CSS that you need for the basic interface. You are free to update and change them as you want.</p> <p>The <code>devinit</code> branch includes the code that we are going to step through here. You CAN copy and paste the code from this branch if you want... but we recommend that you write the code yourself with your own style as you understand the steps and functions. Your code does NOT have to look the same as the code in <code>devinit</code>. That branch is just one possible solution.</p> <h3 id="initial-call-for-data"><a href="#initial-call-for-data" class="header-anchor">#</a> Initial Call for Data</h3> <p>Once the webpage has connected to the database and the DOM is ready, then we can make our first call with <code>getDocs</code>. This will retrieve an entire collection and return a snapshot object.</p> <p>The snapshot object will have a <code>forEach</code> method that we can use to loop through ALL the documents and build our HTML. It's just like making a <code>fetch</code> call and then looping through the JS Object that we extracted from the returned JSON.</p> <p>Use one function to retrieve the data from the database and populate the people array. The people array can be global or inside the function, depending on whether or not you want to use the array for some other purpose later on.</p> <p>Use a second function to build the HTML based on the people array. Designed to accept an array so the function can be used again later on, if needed. This function will be pretty much the same as what you would have done to build HTML with data from JSON.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//to hold all the people from the collection</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//call this from DOMContentLoaded init function </span>
  <span class="token comment">//the db variable is the one created by the getFirestore(app) call.</span>
  <span class="token keyword">const</span> querySnapshot <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDocs</span><span class="token punctuation">(</span><span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'people'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  querySnapshot<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//every `doc` object has a `id` property that holds the `_id` value from Firestore.</span>
    <span class="token comment">//every `doc` object has a doc() method that gives you a JS object with all the properties</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> doc<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    people<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token punctuation">,</span> <span class="token operator">...</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">buildPeople</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">buildPeople</span><span class="token punctuation">(</span><span class="token parameter">people</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//build the HTML</span>
  <span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'ul.person-list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> months <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'January'</span><span class="token punctuation">,</span> <span class="token string">'February'</span><span class="token punctuation">,</span> <span class="token string">'March'</span><span class="token punctuation">,</span> <span class="token string">'April'</span><span class="token punctuation">,</span> <span class="token string">'May'</span><span class="token punctuation">,</span> <span class="token string">'June'</span><span class="token punctuation">,</span> <span class="token string">'July'</span><span class="token punctuation">,</span> <span class="token string">'August'</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">//replace the old ul contents with the new.</span>
  ul<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> people<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> dob <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>months<span class="token punctuation">[</span>person<span class="token punctuation">[</span><span class="token string">'birth-month'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">[</span><span class="token string">'birth-day'</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token comment">//Use the number of the birth-month less 1 as the index for the months array</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li data-id=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; class=&quot;person&quot;&gt;
            &lt;p class=&quot;name&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;
            &lt;p class=&quot;dob&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dob<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;
          &lt;/li&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>Now just repeat these two functions for the <code>gift-ideas</code> collection and HTML... with a couple minor differences.</p> <p>The call to get the ideas is not just <code>getDocs</code> in the <code>gift-ideas</code> collection. We need to use the <code>query</code> method and limit our returned documents by ones that match the <code>person-id</code> of the selected person in the people list.</p> <p>You need to import <code>{query, where}</code> to get a filtered list of documents from <code>gift-ideas</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>query<span class="token punctuation">,</span> where<span class="token punctuation">,</span> collection<span class="token punctuation">,</span> getDocs<span class="token punctuation">,</span> doc<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getIdeas</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//get an actual reference to the person document </span>
  <span class="token keyword">const</span> personRef <span class="token operator">=</span> <span class="token function">doc</span><span class="token punctuation">(</span><span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'people'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//then run a query where the `person-id` property matches the reference for the person</span>
  <span class="token keyword">const</span> docs <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>
    <span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'gift-ideas'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'person-id'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> personRef<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> querySnapshot <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDocs</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>

  querySnapshot<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token comment">//work with the resulting docs</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Remember to make your function <code>async</code> if you are using <code>await</code>.</p> <h3 id="save-new-person-or-idea"><a href="#save-new-person-or-idea" class="header-anchor">#</a> Save New Person or Idea</h3> <p>First, remember to import <code>{ addDoc, collection }</code> from <code>firebase/firestore</code>.</p> <p>To add a person to the Firestore database, the user will click an ADD button near the top of either the People or the Gift Ideas list. This should make the dialog appear.</p> <p>The user will fill in the fields in the dialog. One field per property in the document to be created. When the user clicks the Save button you create the object with those properties.</p> <p>You then take that object and pass it to the <code>addDoc</code> method so that it gets sent to Firestore.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">savePerson</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//function called when user clicks save button from person dialog</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">let</span> month <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'month'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">let</span> day <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> <span class="token operator">!</span>month <span class="token operator">||</span> <span class="token operator">!</span>day<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//form needs more info </span>
  <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    <span class="token string-property property">'birth-month'</span><span class="token operator">:</span> month<span class="token punctuation">,</span>
    <span class="token string-property property">'birth-day'</span><span class="token operator">:</span> day
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> docRef <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">addDoc</span><span class="token punctuation">(</span><span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'people'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> person <span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Document written with ID: '</span><span class="token punctuation">,</span> docRef<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1. clear the form fields </span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'month'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token comment">//2. hide the dialog and the overlay</span>
    <span class="token function">hideOverlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3. display a message to the user about success </span>
    <span class="token function">tellUser</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Person </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> added to database</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span>id <span class="token operator">=</span> docRef<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    <span class="token comment">//4. ADD the new HTML to the &lt;ul&gt; using the new object</span>
    <span class="token function">showPerson</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error adding document: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//do you want to stay on the dialog?</span>
    <span class="token comment">//display a mesage to the user about the problem</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>The <code>tellUser</code> function can be whatever you want it to be as long as it display the success message on the screen for the user.</p> <p>The <code>showPerson()</code> function should be written in a way that it searches for an HTML element with a matching id first. If one exists, then update it. If it doesn't exist then create the <code>&lt;li&gt;</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">showPerson</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//update on screen</span>
    <span class="token keyword">const</span> dob <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>months<span class="token punctuation">[</span>person<span class="token punctuation">[</span><span class="token string">'birth-month'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">[</span><span class="token string">'birth-day'</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token comment">//Use the number of the birth-month less 1 as the index for the months array</span>
    <span class="token comment">//replace the existing li with this new HTML</span>
    li<span class="token punctuation">.</span>outerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li data-id=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; class=&quot;person&quot;&gt;
            &lt;p class=&quot;name&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;
            &lt;p class=&quot;dob&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dob<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;
          &lt;/li&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">//add to screen</span>
    <span class="token keyword">const</span> dob <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>months<span class="token punctuation">[</span>person<span class="token punctuation">[</span><span class="token string">'birth-month'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">[</span><span class="token string">'birth-day'</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token comment">//Use the number of the birth-month less 1 as the index for the months array</span>
    li <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li data-id=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; class=&quot;person&quot;&gt;
            &lt;p class=&quot;name&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;
            &lt;p class=&quot;dob&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dob<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;
          &lt;/li&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'ul.person-list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> li<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>We will repeat this same process for adding a new idea. Same Firestore methods, with a different collection name - <code>gift-ideas</code>.</p> <p>The <code>savePerson</code> method will be duplicated as <code>saveGift</code> and will have the new properties that match the ones being used in <code>gift-ideas</code> collection documents.</p> <p>The HTML that we generate will be slightly different and should match the default content in the starter HTML file.</p> <h3 id="notes-on-onsnapshot"><a href="#notes-on-onsnapshot" class="header-anchor">#</a> Notes on onSnapshot</h3> <p>The <code>onSnapshot</code> method will listen for changes that happen to a collection in the database. <a href="/F2022/modules/hybrid/firebase/firestore/#listening-for-changes-in-the-database">See notes on previous page</a>. Each collection needs its own <code>onSnapshot</code>. When this method is triggered, you will have a snapshot object that can be looped through with a <code>forEach</code> method.</p> <p>If difference between the initial snapshot data load and the data you get in the snapshot created by <code>onSnapshot</code>, is that the <code>onSnapshot</code> data will ONLY include the NEW data (the data that has been added or changed).</p> <p>When you use the snapshot forEach we need to match the <code>_id</code> of the changed/added document with the <code>id</code> property of an HTML element. If there is no match for the <code>_id</code> from the database, then it means that it is a brand new document and it needs to be added to the page.</p> <p>The same process will be repeated for the <code>people</code> collection and the <code>gift-ideas</code> collection.</p> <h3 id="notes-on-editing-data"><a href="#notes-on-editing-data" class="header-anchor">#</a> Notes on Editing Data</h3> <p>Editing (or updating) data is almost the same thing as adding data. One uses an <code>addDoc</code> method and the other uses a <code>setDoc</code> method.</p> <p>The <code>addDoc</code> method does not have an id, which means it does not have a <code>document Reference</code> object. The <code>document reference</code> gets created after the <code>addDoc</code> has run.</p> <p>When you <code>setDoc</code> you must have a <code>document reference</code>, which means you need to know what the <code>_id</code> is.</p> <p>In your JavaScript, you can use the same function to save the data. You just need to know what was clicked to call the function. An Add button will have different HTML than an Edit button or its containing <code>&lt;li&gt;</code>. Here is a sample piece of HTML.</p> <div class="language-HTML line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btnAdd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Add Thing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>thing-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>some-document-id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>thing<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Some text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>edit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>delete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>some-document-id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>thing<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Some text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>edit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>delete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>some-document-id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>thing<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Some text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>edit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>delete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>You can add a click listener to <code>#btnAdd</code> and another to <code>ul.thing-list</code>. Both listeners will call the same function.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//ev.target; - could be the button OR anything in the ul.</span>
  <span class="token keyword">const</span> li <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.thing'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//see if there is a parent &lt;li class=&quot;thing&quot;&gt;</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> li <span class="token operator">?</span> li<span class="token punctuation">.</span>id <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// if li exists then the user clicked inside an &lt;li&gt;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//user clicked inside li</span>
    <span class="token comment">//did they click the li content OR an edit button OR a delete button?</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'edit'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//EDIT the doc using the id to get a docRef</span>
      <span class="token comment">//show the dialog form to EDIT the doc (same form as ADD)</span>
      <span class="token comment">//Load all the Thing document details into the form from docRef</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//DELETE the doc using the id to get a docRef</span>
      <span class="token comment">//do a confirmation before deleting </span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token comment">//content inside the &lt;li&gt; but NOT a &lt;button&gt; was clicked </span>
      <span class="token comment">//Are you just selecting a Thing for a purpose?</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">//clicked a button not inside &lt;li class=&quot;thing&quot;&gt;</span>
    <span class="token comment">//Show the dialog form to ADD the doc (same form as EDIT)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>After the user has filled in the form and clicks on the <code>Save</code> button, this is when you will actually call the <code>addDoc</code> or <code>setDoc</code> method.</p> <p>But how do we know if the save is supposed to be an Add or an Edit?</p> <p>By whether or not there is an <code>id</code> in the dialog form.</p> <p>To store an <code>id</code> in the dialog form you have a couple options.</p> <ol><li>Add an `<input type="hidden" value=""> to the dialog. If it is empty you add. If it has a value then this is an edit.</li> <li>Add a <code>data-id</code> attribute to the <code>Save</code> button in the dialog. If it is empty you add. If it has a value then this is an edit.</li></ol> <p>In the <code>handleClick</code> function, if it is an <code>Edit</code> operation, then you take the id and assign it to the input or the button.</p> <p>After a successful save, when you are hiding the dialog and the overlay, remember to clear out the old id when you clear out the form fields.</p> <h3 id="notes-on-deleting-data"><a href="#notes-on-deleting-data" class="header-anchor">#</a> Notes on Deleting Data</h3> <p>Deleting is similar to editing, in that you must have a document reference which you get from the <code>_id</code>.</p> <div class="custom-block danger"><p class="custom-block-title">Always Confirm</p> <p>Any time you delete something from a database, remember that this is a permanent action. It cannot be undone.
ALWAYS do a confirmation with your user BEFORE doing a delete operation.</p></div> <p>See the code sample in the <strong>EDIT</strong> notes above about implementing the delete.</p> <h2 id="requirements-for-assignment"><a href="#requirements-for-assignment" class="header-anchor">#</a> Requirements for Assignment</h2> <p>See the Assignment page for the first hybrid assignment in <code>BS LMS</code> for the full official requirements list and due date.</p> <p><a href="https://prof3ssorst3v3.github.io/firestore-giftr-starter/dist/" target="_blank" rel="noopener noreferrer">Here is the link to the demo version<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that has the <code>Read</code> and <code>Create</code> features.</p> <p>The summary of what you are doing is:</p> <ol><li>Add the ability to edit any person or gift idea document from your firestore database.</li> <li>Add the ability to delete any person or gift idea document from your firestore database.</li> <li>Add a listener for <code>onSnapshot</code> which will update the lists if changes are made in the database.</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/2/2022, 12:15:37 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/F2022/modules/hybrid/firebase/firestore/" class="prev router-link-active">
        Firebase Firestore
      </a></span> <span class="next"><a href="/F2022/modules/hybrid/firebase/authentication/">
        Firebase Authentication
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/F2022/assets/js/app.e8c285b9.js" defer></script><script src="/F2022/assets/js/2.9a13455f.js" defer></script><script src="/F2022/assets/js/23.c7ffdeef.js" defer></script><script src="/F2022/assets/js/6.351fee7d.js" defer></script>
  </body>
</html>
