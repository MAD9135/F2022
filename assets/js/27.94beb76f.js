(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{545:function(t,s,e){"use strict";e.r(s);var a=e(43),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("PageHeader"),t._v(" "),e("h2",{attrs:{id:"setting-permissions-for-access-to-firestore"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setting-permissions-for-access-to-firestore"}},[t._v("#")]),t._v(" Setting Permissions for Access to Firestore")]),t._v(" "),e("p",[t._v("We actually talked about these very briefly in the initial discussion about setting up the Firebase app and database.")]),t._v(" "),e("p",[t._v("In the Firebase console, in the Firestore Cloud Database section, go from the default "),e("code",[t._v("data")]),t._v(" tab to the "),e("code",[t._v("rules")]),t._v(" tab. You will see something like this:")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("div",{staticClass:"highlight-lines"},[e("br"),e("br"),e("br"),e("br"),e("br"),e("div",{staticClass:"highlighted"},[t._v("Â ")]),e("br"),e("br"),e("br"),e("br")]),e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("rules_version "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nservice cloud"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firestore "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  match "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("databases"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("database"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("documents "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    match "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("document"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      allow read"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("write")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v("\n          request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("time "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" timestamp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br")])]),e("p",[t._v("Notice the "),e("code",[t._v("timestamp.date")]),t._v(" value on the highlighted line and how it is currently set to Dec 25th, 2022. This is a base permission set that allows any user to read or write to the database up until that date.")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://firebase.google.com/docs/firestore/security/get-started",target:"_blank",rel:"noopener noreferrer"}},[t._v("Firestore security overview reference"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://firebase.google.com/docs/firestore/quickstart#secure_your_data",target:"_blank",rel:"noopener noreferrer"}},[t._v("Firestore quickstart for securing your data"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("The syntax of the rules file is similar to JavaScript. There will be many sets of "),e("code",[t._v("{}")]),t._v(" nested inside of each other.")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("match")]),t._v(" commands are trying to match parts of the path in your database. Every time you try to connect to the database and read or write some data, these "),e("code",[t._v("match")]),t._v(" commands run. If we were talking about setting permissions on documents that were inside the "),e("code",[t._v("people")]),t._v(" collection that we have been using, then a path could be "),e("code",[t._v("/databases/fire-giftr/people/documents/")]),t._v(". The name of the database can be replaced with "),e("code",[t._v("{database}")]),t._v(". This will take the second part of the path and create a variable called "),e("code",[t._v("database")]),t._v(" that can be used inside of the set of "),e("code",[t._v("{}")]),t._v(" after the match.")]),t._v(" "),e("p",[t._v("The first match statement in the example above is "),e("code",[t._v("match /databases/{database}/documents {")]),t._v(". It has no collection name specified. Instead, it is matching all documents in all collections in the database. If you want, you can create a different match statement for each collection.")]),t._v(" "),e("p",[t._v("In the second match statement, "),e("code",[t._v("match /{document=**} {")]),t._v(" the command will match against any and all documents from any collection specified in the parent match statement.")]),t._v(" "),e("p",[t._v("Once you have your match command to find the appropriate documents, then we use the "),e("code",[t._v("allow")]),t._v(" command. You can write one "),e("code",[t._v("allow")]),t._v(" command for both "),e("code",[t._v("read")]),t._v(" and "),e("code",[t._v("write")]),t._v(" or separate ones for each. After the "),e("code",[t._v("allow")]),t._v(", you need to add an "),e("code",[t._v("if")]),t._v(" statement.")]),t._v(" "),e("p",[t._v("If you want to restrict access to all documents to users who are logged in, you could use this:")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("allow read"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("write")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("When adding restrictions on READ operations, be careful about what you disallow. If you need to be able to access documents in a "),e("code",[t._v("users")]),t._v(" collection when a person is logging in, then do not include "),e("code",[t._v("allow read request.auth != null")]),t._v(" in your rules. You wouldn't be able to read the user collection and compare its values to values from the website.")]),t._v(" "),e("p",[t._v("Here is a rule that says that documents in the "),e("code",[t._v("users")]),t._v(" collection can be "),e("code",[t._v("read")]),t._v(", "),e("code",[t._v("update")]),t._v(", or "),e("code",[t._v("delete")]),t._v(", if the user doing the operation is signed in AND the id of the user matches the id in the record being read, updated, or deleted. In order to create a new document in the collection, the person must not be signed in.")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("match "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("users"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("userId"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      allow read"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" userId"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      allow create"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[t._v("Here is a rule that says anyone can "),e("code",[t._v("Read")]),t._v(" from the "),e("code",[t._v("people")]),t._v(" collection but only users who are signed in with Firebase Authentication can "),e("code",[t._v("Write")]),t._v(". And, only signed in users can read from the "),e("code",[t._v("gift-ideas")]),t._v(" and nobody can write to the collection.  "),e("code",[t._v("person")]),t._v(" and "),e("code",[t._v("idea")]),t._v(" are turned into variables that could be used in those if statements.")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("rules_version "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nservice cloud"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firestore "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  match "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("databases"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("database"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("documents "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Match any document in the 'people' collection")]),t._v("\n    match "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("people"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("person"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      allow read"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      allow write"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Match any document in the 'gift-ideas' collection")]),t._v("\n    match "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gift"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ideas"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("idea"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      allow read"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      allow write"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    match "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("users"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      allow read"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      allow write"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id \n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br")])]),e("p",[t._v("Other keywords for "),e("code",[t._v("allow")]),t._v(" include")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("get")]),t._v(" applies to single document read requests")]),t._v(" "),e("li",[e("code",[t._v("list")]),t._v(" applies to getDocs, queries, and collection reads")]),t._v(" "),e("li",[e("code",[t._v("update")]),t._v(" applies to setDoc write commands")]),t._v(" "),e("li",[e("code",[t._v("create")]),t._v(" applies to addDoc write commands")]),t._v(" "),e("li",[e("code",[t._v("delete")]),t._v(" you should be able to guess this one")])]),t._v(" "),e("p",[t._v("If there are multiple match commands that overlap and apply to the same data, then the operation will be allowed if ANY of the match and allow statements allow it.")]),t._v(" "),e("p",[t._v("If you want to restrict a create command to force certain fields to be present before the create can run.")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("match "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("people"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("person"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  allow create"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasAll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'birth-month'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'birth-day'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'owner'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("p",[t._v("In the "),e("code",[t._v("if")]),t._v(" statement "),e("code",[t._v("request.resource.data")]),t._v(" is the object being passed to the database. The "),e("code",[t._v("keys()")]),t._v(" method returns an array of all the property names in the object. "),e("code",[t._v("hasAll()")]),t._v(" lets you provide a list of required fields. There is also an "),e("code",[t._v("affectedKeys()")]),t._v(" method that will give you the names of the fields that were affected by a write operation, eg an update.")]),t._v(" "),e("p",[t._v("If you want to ensure that submitted objects have the correct datatypes:")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("allow write"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name is string "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n          request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("birth"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("month is int "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n          request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("birth"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("day is int "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n          request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("owner is path "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[t._v("Valid data types for the is operator are bool, bytes, float, int, list, latlng, number, path, map, string, and timestamp.")]),t._v(" "),e("h2",{attrs:{id:"hybrid-assignment-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hybrid-assignment-3"}},[t._v("#")]),t._v(" Hybrid Assignment 3")]),t._v(" "),e("p",[t._v("The third Hybrid assignment has a full description of the requires in the assignment page in BS LMS. This is the general description and steps to achieve it.")]),t._v(" "),e("p",[t._v("To complete the third Hybrid assignment, you need to start with the second Hybrid that includes the ability to sign in and out with Firebase Authentication.")]),t._v(" "),e("p",[t._v("In this assignment you will add two important features:")]),t._v(" "),e("ol",[e("li",[t._v("Modifying the database to store user information and separate access to that data based on the user.")]),t._v(" "),e("li",[t._v("Adding permissions to the database to prevent attempts to circumvent the data access by changing the JavaScript.")])]),t._v(" "),e("p",[t._v("The first feature is the ability to connect data to specific users. The same "),e("code",[t._v("people")]),t._v(" and "),e("code",[t._v("gift-ideas")]),t._v(" collections will be used but another "),e("code",[t._v("users")]),t._v(" collection will be added to track the people using the website and you will add an "),e("code",[t._v("owner")]),t._v(" property to the "),e("code",[t._v("people")]),t._v(" collection.")]),t._v(" "),e("p",[t._v("The documents in the "),e("code",[t._v("people")]),t._v(" collection need to now include a "),e("code",[t._v("user id")]),t._v(".  You can use a "),e("code",[t._v("String")]),t._v(" property to hold on to the user id in the people documents. When a person is added to the collection, the user id should be added too. When the list of people is shown, only the people belonging to the current user id should be shown. This will require you modifying your code to include the user id in a query to retrieve the list of people.")]),t._v(" "),e("p",[t._v("A more common approach when adding ownership of a document is to create a collection in the database called "),e("code",[t._v("users")]),t._v(". The documents in the "),e("code",[t._v("users")]),t._v(" collection will hold the user id, user displayName, and any other user information that you want. The user id in the "),e("code",[t._v("users")]),t._v(" collection documents will be the user id that we get from the sign in process. Once you have a collection that holds the users, it means that we can use a "),e("code",[t._v("Reference")]),t._v(" property instead of a "),e("code",[t._v("String")]),t._v(" property in the "),e("code",[t._v("people")]),t._v(" collection documents.")]),t._v(" "),e("p",[t._v("So, the documents in the "),e("code",[t._v("users")]),t._v(" collection will look like this:")]),t._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0sZd4GoCLLe7zmly1xO3"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"displayName"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sterling Archer"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[t._v("Other properties are allowed but are optional. Values like the user email, the time the account was created or the last login time are common values to keep in the "),e("code",[t._v("users")]),t._v(" documents.")]),t._v(" "),e("p",[t._v("The new version of the documents in "),e("code",[t._v("people")]),t._v(" looks like:")]),t._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"G9X6SFu6hGogyqvX19tO"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Rick"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"birth-month"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"birth-day"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"owner"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/users/0sZd4GoCLLe7zmly1xO3"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br")])]),e("p",[t._v("The "),e("code",[t._v("owner")]),t._v(" property is a Reference data type pointing to a document in the "),e("code",[t._v("users")]),t._v(" collection.")]),t._v(" "),e("p",[t._v("For this to work, we need to be putting the user information into a document in the "),e("code",[t._v("users")]),t._v(" collection when they sign in. We don't need to do this when they change pages and we "),e("code",[t._v("reauthenticateWithCredential")]),t._v(". This is just the first login on the site for each session.")]),t._v(" "),e("p",[t._v("We can use the "),e("code",[t._v("setDoc()")]),t._v(" method for adding or updating. Call the "),e("code",[t._v("doc()")]),t._v(" method to try and find a reference to a document with the specified id. If the document does not exist, it gets created by the "),e("code",[t._v("doc()")]),t._v(" method. Then the "),e("code",[t._v("setDoc()")]),t._v(" does an update on the document. So, if the user changed their displayName or email or anything else in the "),e("code",[t._v("user")]),t._v(" object returned from the provider, then that new information will be put into your "),e("code",[t._v("users")]),t._v(" collection document.")]),t._v(" "),e("p",[t._v("The id that we are using is the one that refers to the users Github or Twitter account.")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("attemptLogin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//add the setPersistence function here if not doing your own session code ")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("signInWithPopup")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("auth"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" provider"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("result")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//call setDoc to add/update the user document in the `users` collection ")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" usersColRef "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("collection")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("db"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'users'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setDoc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("doc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("usersColRef"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("displayName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("displayName\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("merge")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// plus any other fields you want to save in the object ")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//When calling doc(), if the document does not exist, it will be created")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//handle errors")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br")])]),e("p",[t._v("by adding the "),e("code",[t._v("{merge:true}")]),t._v(" object as the third parameter for "),e("code",[t._v("setDoc")]),t._v(" it means nothing will be written to the database if the user already exists and no changes to the data are present.")]),t._v(" "),e("p",[t._v("When you need a reference to a specific user document, for a signed in user, you can also use the "),e("code",[t._v("FirebaseAuth.instance.currentUser.uid")]),t._v(" property to find the user document.")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUser")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ref "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("doc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("db"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" FirebaseAuth"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("instance"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("currentUser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ref"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//if you need the user reference")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[t._v("Your "),e("code",[t._v("people")]),t._v(" collection documents should use a new property called "),e("code",[t._v("owner")]),t._v(", which is a reference to a user document, you can use the above method to get a reference to the currently signed in user.")]),t._v(" "),e("p",[t._v("Then your "),e("code",[t._v("getDocs")]),t._v(" process in the "),e("code",[t._v("getPeople")]),t._v(" function, would become a new query with a filter.")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPeople")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" userRef "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUser")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" peopleCollectionRef "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("collection")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("db"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"people"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//collection we want to query")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" docs "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    peopleCollectionRef"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("where")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'owner'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'=='")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" userRef"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" querySnapshot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDocs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("docs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  querySnapshot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("doc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//loop through people documents that are owned by the logged in user")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br")])]),e("p",[t._v("The second feature is the setting up of Database permissions, as explained at the top of this page.")]),t._v(" "),e("p",[t._v("The minimum permissions that you will need in your database are:")]),t._v(" "),e("ul",[e("li",[t._v("Documents in the "),e("code",[t._v("people")]),t._v(" collection can only be read, updated or deleted if the owner field matches the path of the logged in user.")]),t._v(" "),e("li",[t._v("New documents in the "),e("code",[t._v("people")]),t._v(" collection can be created by anyone who is logged in.")]),t._v(" "),e("li",[t._v("Documents in the "),e("code",[t._v("gift-ideas")]),t._v(" collection can be read or written by anyone who is logged in.")]),t._v(" "),e("li",[t._v("Users can only read, update, or delete their own document in the "),e("code",[t._v("users")]),t._v(" collection.")]),t._v(" "),e("li",[t._v("Anyone can create new documents in the "),e("code",[t._v("users")]),t._v(" collection.")])]),t._v(" "),e("p",[t._v("You can add other permissions as you wish.")]),t._v(" "),e("p",[t._v("Once both of these features have been completed, you will have built an app with a secure database which is accessible only to users who have logged into your app using Github or Twitter credentials, they will only be able to access their own data, and all the "),e("code",[t._v("user")]),t._v(", "),e("code",[t._v("people")]),t._v(", and "),e("code",[t._v("idea")]),t._v(" data will be connected and organized so the proper query will run efficiently to return each user only their own data.")])],1)}),[],!1,null,null,null);s.default=n.exports}}]);